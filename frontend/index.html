<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIVI Validator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="app">
        <!-- Ambient Background -->
        <div class="ambient-bg">
            <div class="gradient-orb orb-1"></div>
            <div class="gradient-orb orb-2"></div>
            <div class="gradient-orb orb-3"></div>
        </div>

        <!-- Main Upload Interface -->
        <main class="main-container" id="uploadView">
            <!-- Brand Header - Centered Above Card -->
            <div class="brand-header">
                <span class="brand-name">Hienfeld Smits</span>
            </div>

            <div class="upload-card">
                <div class="upload-card-inner">
                    <!-- Upload Zone (hidden visually but functional for drag-drop) -->
                    <div class="upload-zone" id="uploadZone">
                        <input type="file" id="fileInput" accept=".xml" hidden>
                        <input type="file" id="folderInput" webkitdirectory hidden>
                    </div>

                    <!-- Upload Buttons -->
                    <div class="upload-buttons">
                        <button class="upload-btn" id="addXmlBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Add XML
                        </button>
                        <button class="upload-btn" id="addFolderBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M22 19C22 19.5304 21.7893 20.0391 21.4142 20.4142C21.0391 20.7893 20.5304 21 20 21H4C3.46957 21 2.96086 20.7893 2.58579 20.4142C2.21071 20.0391 2 19.5304 2 19V5C2 4.46957 2.21071 3.96086 2.58579 3.58579C2.96086 3.21071 3.46957 3 4 3H9L11 6H20C20.5304 6 21.0391 6.21071 21.4142 6.58579C21.7893 6.96086 22 7.46957 22 8V19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Add folders
                        </button>
                    </div>

                    <!-- Selected File State -->
                    <div class="file-selected" id="selectedFile" hidden>
                        <div class="file-info">
                            <div class="file-icon-wrapper">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M14 2V8H20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <span class="file-name" id="fileName"></span>
                        </div>
                        <button class="file-remove" id="removeFile" title="Verwijder">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Collapsible Options Section (hidden until file selected) -->
                    <div class="options-accordion" id="optionsAccordion" hidden>
                        <button class="options-toggle" id="optionsToggle" type="button">
                            <span class="options-toggle-text">Validatie opties</span>
                            <svg class="options-toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <div class="options-content" id="optionsContent">
                            <label class="compact-option">
                                <input type="checkbox" id="engine1" checked>
                                <span class="compact-check"></span>
                                <span>Schema</span>
                            </label>
                            <label class="compact-option">
                                <input type="checkbox" id="engine2" checked>
                                <span class="compact-check"></span>
                                <span>Business Rules</span>
                            </label>
                            <label class="compact-option">
                                <input type="checkbox" id="engine3" checked>
                                <span class="compact-check"></span>
                                <span>AI Analyse</span>
                            </label>
                        </div>
                    </div>

                    <!-- API Key Section (hidden by default) -->
                    <div class="api-key-section" id="apiKeySection" hidden>
                        <input type="password" id="apiKey" class="api-key-input" placeholder="Anthropic API Key">
                    </div>

                    <!-- Validate Button -->
                    <div class="validate-section">
                        <button class="validate-btn" id="validateButton" disabled>
                            <span class="btn-text">Valideren</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Results View -->
        <div class="results-view" id="resultsView" hidden>
            <header class="results-header">
                <button class="back-btn" id="backButton">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Nieuwe validatie</span>
                </button>
                <div class="results-file-info">
                    <span class="results-filename" id="resultsFileName"></span>
                </div>
            </header>

            <div class="results-content">
                <!-- Summary Cards -->
                <div class="summary-section">
                    <div class="summary-grid">
                        <div class="summary-card card-critical">
                            <div class="card-value" id="kritiekCount">0</div>
                            <div class="card-label">Kritiek</div>
                            <div class="card-sublabel">Moet opgelost</div>
                        </div>
                        <div class="summary-card card-warning">
                            <div class="card-value" id="aandachtCount">0</div>
                            <div class="card-label">Aandacht</div>
                            <div class="card-sublabel">Review nodig</div>
                        </div>
                        <div class="summary-card card-info">
                            <div class="card-value" id="infoCount">0</div>
                            <div class="card-label">Info</div>
                            <div class="card-sublabel">Ter kennisgeving</div>
                        </div>
                        <div class="summary-card card-total">
                            <div class="card-value" id="totalCount">0</div>
                            <div class="card-label">Totaal</div>
                            <div class="card-sublabel" id="openCount">0 open</div>
                        </div>
                    </div>
                    <div class="summary-meta">
                        <span id="contractsInfo"></span>
                        <span class="meta-divider"></span>
                        <span id="enginesInfo"></span>
                    </div>
                </div>

                <!-- Findings Section -->
                <div class="findings-section">
                    <!-- Category Tabs -->
                    <div class="category-tabs" id="categoryTabs">
                        <button class="category-tab active" data-category="all">
                            <span class="tab-label">Alle</span>
                            <span class="tab-count" id="categoryAllCount">0</span>
                        </button>
                        <button class="category-tab" data-category="inhoudelijk">
                            <span class="tab-label">Inhoudelijk</span>
                            <span class="tab-count" id="categoryInhoudelijkCount">0</span>
                        </button>
                        <button class="category-tab" data-category="ontbrekend">
                            <span class="tab-label">Ontbrekend</span>
                            <span class="tab-count" id="categoryOntbrekendCount">0</span>
                        </button>
                    </div>

                    <!-- Progress Bar -->
                    <div class="review-progress" id="reviewProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="progressText">0 van 0 afgehandeld (0%)</span>
                    </div>

                    <div class="findings-toolbar">
                        <h2 class="findings-title">Bevindingen</h2>
                        <div class="toolbar-actions">
                            <div class="filter-group">
                                <select id="criticalityFilter" class="filter-select">
                                    <option value="all">Alle niveaus</option>
                                    <option value="KRITIEK">Kritiek</option>
                                    <option value="AANDACHT">Aandacht</option>
                                    <option value="INFO">Info</option>
                                </select>
                                <select id="statusFilter" class="filter-select">
                                    <option value="all">Alle statussen</option>
                                    <option value="OPEN">Open</option>
                                    <option value="GEACCEPTEERD">Geaccepteerd</option>
                                    <option value="GENEGEERD">Genegeerd</option>
                                    <option value="OPGELOST">Opgelost</option>
                                </select>
                                <select id="severityFilter" class="filter-select">
                                    <option value="all">Alle ernst</option>
                                    <option value="FOUT">Fout</option>
                                    <option value="WAARSCHUWING">Waarschuwing</option>
                                    <option value="INFO">Info</option>
                                </select>
                                <select id="engineFilter" class="filter-select">
                                    <option value="all">Alle engines</option>
                                    <option value="1">Schema</option>
                                    <option value="2">Rules</option>
                                    <option value="3">AI</option>
                                </select>
                            </div>
                            <div class="search-wrapper">
                                <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                                    <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <input type="text" id="searchFilter" class="search-input" placeholder="Zoeken...">
                            </div>
                        </div>
                    </div>

                    <!-- Grouped Findings View -->
                    <div class="findings-grouped" id="findingsGrouped"></div>

                    <!-- Classic Table View (hidden by default) -->
                    <div class="findings-table-wrapper" id="findingsTableWrapper" hidden>
                        <table class="findings-table" id="findingsTable">
                            <thead>
                                <tr>
                                    <th>Niveau</th>
                                    <th>Ernst</th>
                                    <th>Code</th>
                                    <th>Contract</th>
                                    <th>Entiteit</th>
                                    <th>Label</th>
                                    <th>Omschrijving</th>
                                    <th>Status</th>
                                    <th class="col-action"></th>
                                </tr>
                            </thead>
                            <tbody id="findingsBody"></tbody>
                        </table>
                    </div>

                    <div class="no-findings" id="noFindings" hidden>
                        <div class="no-findings-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                                <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <p>Geen bevindingen met huidige filters</p>
                    </div>
                </div>

                <!-- Export Section -->
                <div class="export-section">
                    <button class="export-btn" id="downloadJson">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        JSON
                    </button>
                    <button class="export-btn" id="downloadExcel">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Excel
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Toast -->
        <div class="toast" id="errorToast" hidden>
            <div class="toast-content">
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="toast-message" id="errorText"></span>
            </div>
        </div>

        <!-- Bulk Action Modal -->
        <div class="modal-backdrop" id="bulkActionModal" hidden>
            <div class="modal">
                <div class="modal-header">
                    <h3>Bulk actie</h3>
                </div>
                <div class="modal-body">
                    <p id="bulkActionMessage"></p>
                    <p class="modal-detail" id="bulkActionDetails"></p>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn btn-secondary" id="bulkActionSingle">Alleen deze</button>
                    <button class="modal-btn btn-primary" id="bulkActionAll">Alle toepassen</button>
                </div>
            </div>
        </div>

        <!-- Chat Widget -->
        <div class="chat-widget" id="chatWidget">
            <button class="chat-fab" id="chatFab" title="SIVI Assistent">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <div class="chat-panel" id="chatPanel" hidden>
                <div class="chat-header" id="chatHeader">
                    <div class="chat-title">
                        <div class="chat-avatar">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span>SIVI Assistent</span>
                    </div>
                    <button class="chat-close" id="chatClose">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>

                <div class="chat-body" id="chatBody">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-welcome">
                            <p>Vraag me alles over SIVI validatie.</p>
                            <ul>
                                <li>Waarom is deze code ongeldig?</li>
                                <li>Welke waarden zijn toegestaan?</li>
                                <li>Wat betekent fout E2-002?</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chat-suggestions" id="chatSuggestions" hidden>
                        <div class="suggestions-list" id="suggestionsList"></div>
                    </div>

                    <div class="chat-context" id="chatContext" hidden>
                        <span class="context-badge" id="contextFinding"></span>
                        <button class="context-clear" id="clearContext">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>

                    <div class="chat-input-area">
                        <input type="text" id="chatInput" class="chat-input" placeholder="Stel een vraag..." autocomplete="off">
                        <button class="chat-send" id="chatSend" disabled>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
